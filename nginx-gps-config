# Configuración nginx para GPS HTTP en EC2
server {
    listen 80;
    server_name _;
    
    # Directorio donde está la aplicación
    root /var/www/html/gps-tracker;
    index index.html;
    
    # HEADERS CRÍTICOS PARA GPS EN HTTP
    add_header 'Permissions-Policy' 'geolocation=*,camera=*,microphone=*,accelerometer=*,gyroscope=*' always;
    add_header 'Feature-Policy' 'geolocation *; camera *; microphone *; accelerometer *; gyroscope *' always;
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With' always;
    add_header 'Cross-Origin-Embedder-Policy' 'unsafe-none' always;
    add_header 'Cross-Origin-Opener-Policy' 'unsafe-none' always;
    add_header 'Referrer-Policy' 'no-referrer-when-downgrade' always;
    add_header 'X-Content-Type-Options' 'nosniff' always;
    
    # CONFIGURACIÓN ESPECÍFICA PARA GEOLOCATION
    add_header 'X-Frame-Options' 'ALLOWALL' always;
    add_header 'Content-Security-Policy' "default-src 'self' 'unsafe-inline' 'unsafe-eval' *; geolocation-src *; connect-src 'self' wss: ws: https: http: *;" always;
    
    # Configuración para archivos estáticos
    location / {
        try_files $uri $uri/ /index.html;
        
        # Headers específicos para archivos estáticos
        add_header 'Cache-Control' 'no-cache, must-revalidate' always;
        add_header 'Expires' '0' always;
    }
    
    # Configuración para assets
    location /assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Configuración para el manifest y archivos de configuración
    location ~* \.(json|ico|png|svg)$ {
        expires 1d;
        add_header Cache-Control "public";
    }
    
    # Logs específicos para debugging GPS
    access_log /var/log/nginx/gps-tracker-access.log;
    error_log /var/log/nginx/gps-tracker-error.log;
}
