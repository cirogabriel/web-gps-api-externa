<!doctype html>
<html lang="es" className="light">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Aplicaci√≥n premium de seguimiento GPS en tiempo real con Google Maps" />
    <title>GPS Tracker - Seguimiento en Tiempo Real</title>
    
    <!-- FORZAR GPS EN HTTP - PERMISOS CR√çTICOS -->
    <meta http-equiv="Permissions-Policy" content="geolocation=*, camera=*, microphone=*">
    <meta http-equiv="Feature-Policy" content="geolocation *; camera *; microphone *;">
    
    <!-- PWA Manifest para ejecuci√≥n en segundo plano -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#4285F4" />
    
    <!-- SCRIPT PARA FORZAR GPS ANTES DE CARGAR LA APP -->
    <script>
      // FORZAR GPS EN HTTP - OVERRIDE NAVIGATOR
      (function() {
        console.log('[GPS Override] üöÄ Preparando forzado de GPS en HTTP...');
        
        // Forzar permisos sin restricciones de origen
        if (navigator.geolocation) {
          console.log('[GPS Override] ‚úÖ Geolocation API disponible, aplicando override...');
          
          // Guardar m√©todos originales
          const originalGetCurrentPosition = navigator.geolocation.getCurrentPosition;
          const originalWatchPosition = navigator.geolocation.watchPosition;
          
          // Override getCurrentPosition con configuraci√≥n forzada
          navigator.geolocation.getCurrentPosition = function(success, error, options = {}) {
            console.log('[GPS Override] üìç Forzando getCurrentPosition sin restricciones...');
            
            const forcedOptions = {
              enableHighAccuracy: true,
              timeout: 60000,
              maximumAge: 0,
              // Forzar configuraci√≥n para HTTP
              ...options
            };
            
            try {
              originalGetCurrentPosition.call(this, 
                (position) => {
                  console.log('[GPS Override] ‚úÖ GPS obtenido exitosamente:', position.coords);
                  success(position);
                },
                (err) => {
                  console.log('[GPS Override] ‚ö†Ô∏è Error GPS:', err.message);
                  if (error) error(err);
                },
                forcedOptions
              );
            } catch (e) {
              console.error('[GPS Override] ‚ùå Excepci√≥n en getCurrentPosition:', e);
              if (error) error(e);
            }
          };
          
          // Override watchPosition con configuraci√≥n forzada
          navigator.geolocation.watchPosition = function(success, error, options = {}) {
            console.log('[GPS Override] üì° Forzando watchPosition sin restricciones...');
            
            const forcedOptions = {
              enableHighAccuracy: true,
              timeout: 60000,
              maximumAge: 0,
              ...options
            };
            
            try {
              return originalWatchPosition.call(this,
                (position) => {
                  console.log('[GPS Override] üéØ GPS tracking actualizado:', position.coords);
                  success(position);
                },
                (err) => {
                  console.log('[GPS Override] ‚ö†Ô∏è Error en tracking:', err.message);
                  if (error) error(err);
                },
                forcedOptions
              );
            } catch (e) {
              console.error('[GPS Override] ‚ùå Excepci√≥n en watchPosition:', e);
              if (error) error(e);
            }
          };
          
          console.log('[GPS Override] üéØ Override GPS completado - ¬°GPS forzado para HTTP!');
        } else {
          console.error('[GPS Override] ‚ùå Geolocation API no disponible');
        }
      })();
    </script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('SW registrado:', registration);
            })
            .catch(error => {
              console.log('SW fall√≥:', error);
            });
        });
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
